
SET mapred.map.tasks.speculative.execution true;  
SET mapred.reduce.tasks.speculative.execution true;
/*load data with seperator*/
d = load '$input' using PigStorage('|');
 /*filter the data by time stamp*/
temp = filter d by $3<=$end;
data = filter temp by $3>=$begin;
dump data;
/*count the number of occurrence, choose top n*/
b = group data by $0;
E = foreach b generate group,COUNT(data);
top = ORDER E BY $1 DESC;
topn = LIMIT top $n;
DUMP topn;
/*join the data to obtain complete information*/
r = JOIN data by $0, topn by $0;
DUMP r;
/*select hashcode, url and count*/
r1 = foreach r generate $0,$4,$6,$3;

DUMP r1;
/*order by count*/
result = ORDER r1 BY $2 DESC;

DUMP result;
/*store the result into file*/
store result into '/user/biadmin/processed';


